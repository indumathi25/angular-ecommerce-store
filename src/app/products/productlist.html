<div class="min-h-screen bg-gray-50 flex flex-col font-sans">
  <!-- Header -->
  <app-header (searchChange)="onSearch($event)"></app-header>

  <!-- Main Content -->
  <main class="flex-1 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
    <div class="flex flex-col lg:flex-row gap-8">
      <!-- Sidebar Filters -->
      @defer (hydrate on idle) {
      <app-product-filters
        [categories]="categories()"
        [selectedCategories]="selectedCategories()"
        (categoryChange)="toggleCategory($event)"
      ></app-product-filters>
      }

      <!-- Product Grid Section -->
      <div class="flex-1">
        <!-- Sort Toolbar -->
        <div
          class="flex justify-between items-center mb-6 bg-white p-4 rounded-lg shadow-sm border border-gray-100"
        >
          <p class="text-gray-600 text-sm font-medium">
            Showing
            <span class="text-gray-900 font-bold">{{ filteredProducts().length }}</span> products
          </p>
          <div class="flex items-center gap-3">
            <label for="sort" class="text-sm font-medium text-gray-700">Sort by:</label>
            <div class="relative">
              <select
                id="sort"
                (change)="onSortChange($event)"
                class="appearance-none bg-gray-50 border border-gray-300 text-gray-700 text-sm rounded-md focus:ring-yellow-500 focus:border-yellow-500 block w-full p-2.5 pr-8 cursor-pointer hover:bg-gray-100 transition-colors"
              >
                <option value="featured">Featured</option>
                <option value="price-low-high">Price: Low to High</option>
                <option value="price-high-low">Price: High to Low</option>
                <option value="rating">Rating: High to Low</option>
              </select>
              <div
                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700"
              >
                <svg
                  class="fill-current h-4 w-4"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20"
                >
                  <path
                    d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"
                  />
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Loading State -->
        @if (isLoading()) {
        <div class="flex justify-center items-center h-64">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-yellow-500"></div>
        </div>
        }

        <!-- Error State -->
        @if (error()) {
        <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor">
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="ml-3">
              <p class="text-sm text-red-700">{{ error() }}</p>
            </div>
          </div>
        </div>
        }

        <!-- Product Grid -->
        @if (!isLoading() && !error()) { @if (paginatedProducts().length > 0) {
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
          @for (product of paginatedProducts(); track product.id; let i = $index) {
          <app-product-card [product]="product" [priority]="i < 6"></app-product-card>
          }
        </div>
        } @else {
        <div class="flex flex-col items-center justify-center h-64 text-center">
          <svg
            class="w-16 h-16 text-gray-300 mb-4"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
            />
          </svg>
          <h3 class="text-lg font-medium text-gray-900 mb-1">No products found</h3>
          <p class="text-gray-500">
            Try adjusting your search or filters to find what you're looking for.
          </p>
        </div>
        }

        <!-- Pagination -->
        @if (totalPages() > 1) {
        <div class="flex justify-center items-center gap-2">
          <button
            (click)="changePage(currentPage() - 1)"
            [disabled]="currentPage() === 1"
            class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Previous
          </button>

          <span class="text-sm text-gray-700">
            Page <span class="font-medium">{{ currentPage() }}</span> of
            <span class="font-medium">{{ totalPages() }}</span>
          </span>

          <button
            (click)="changePage(currentPage() + 1)"
            [disabled]="currentPage() === totalPages()"
            class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Next
          </button>
        </div>
        } }
      </div>
    </div>
  </main>
  <!-- Footer -->
  @defer (hydrate on viewport) {
  <app-footer></app-footer>
  } @placeholder {
  <div class="h-16 bg-gray-100"></div>
  }
</div>
